<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      #calender-layout {
        text-align: center;
      }
      #calender {
        display: inline-block;
        border: 1px solid black;
        width: 600px;
      }
      table,
      th,
      td {
        border: 1px solid white;
      }
      td,
      #btn_add {
        cursor: pointer;
      }
      table {
        width: 60%;
        margin: auto;
      }
      .normal {
        color: black;
      }
      .after {
        color: gray;
      }
      .before {
        color: gray;
      }
      .selected {
        color: red;
        border: 1px solid red;
      }
      #title {
        width: 60%;
      }
      #content {
        width: 60%;
        height: 20vh;
      }
      .ban {
        pointer-events: none;
        cursor: default;
        color: gray;
      }
    </style>
    <script src="http://code.jquery.com/jquery-3.1.1.js"></script>
    <script>
      // 2021년 1월 1일은 금요일
      $(function () {
        const dateLimit = [0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
        var count = 0;
        var today = new Date();
        const year = 2021;
        var month = today.getMonth() + 1;
        var date = today.getDate();
        // var selected;
        //  var value = { year: year, month: month, date: date };
        $("#new_date").append(year + " " + month + " " + date);
        // var DrawGetBox = function () {
        //   $("#memo").empty();
        //   request.get(
        //     { url: "http://127.0.0.1/52273/diary/" + ChangeIndex(month, date) },
        //     function (error, res, body) {
        //       let data = JSON.parse(body);
        //       if (!error && res.statusCode == 200) {
        //         for (var i = 0; i < data.length; i++) {
        //           console.log(data[i]);
        //         }
        //       }
        //     }
        //   );
        // };
        var DrawCalender = function () {
          // DrawGetBox();
          $("#memo").empty();
          $("#calender-header").empty();
          $("#calender-header").append(
            "<button class='before' value = '" +
              date +
              "'>a</button> " +
              year +
              "." +
              month +
              " <button class='after' value = '" +
              date +
              "'>b</Wbutton>"
          );
          $("#calender-date").empty();
          $("#calender-date").append(
            "<tr><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th><th>일</th></tr>"
          );

          var blank = 4;
          for (var i = 1; i < month; i++) {
            blank += dateLimit[i] % 7;
          }
          blank %= 7;
          count = 0;
          var over = false;
          var part;
          for (var i = 1 - blank; ; i++) {
            var temp = i;
            part = "normal";
            if (temp <= 0) {
              temp += dateLimit[month - 1];
              if (temp <= 0) {
                temp = "X";
                part = "ban";
              } else {
                part = "before";
              }
            } else if (temp > dateLimit[month]) {
              if (month == 12) {
                temp = "X";
                part = "ban";
              } else {
                temp -= dateLimit[month];
                part = "after";
              }
            } else if (temp == dateLimit[month]) {
              over = true;
            }

            var selected;
            if (temp == date && part == "normal") {
              selected = "selected";
            } else {
              selected = "";
            }

            if (count == 0) {
              $("#calender-date").append("<tr>");
            }
            count++;
            $("#calender-date").append(
              "<td class =" +
                selected +
                " " +
                part +
                " value = " +
                temp +
                ">" +
                temp +
                "</td>"
            );
            if (count == 7) {
              $("#calender-date").append("</tr>");
              if (over) break;
              count = 0;
            }
          }
          var DrawmemoBox = function () {};

          var DrawMemo = function () {};
          $("td, .before, .after").click(function () {
            if ($(this).attr("class") == "before") {
              month--;
              if (month == 0) month += 12;
            } else if ($(this).attr("class") == "after") {
              month++;
              if (month == 13) month -= 12;
            }
            date = $(this).attr("value");
            $("#new_date").empty();
            $("#new_date").append(
              year + " " + month + " " + $(this).attr("value")
            );
            DrawCalender();
            DrawMemo();
          });
        };
        DrawCalender();
        var ChangeIndex = function (month, date) {
          var newindex = 0;
          for (var i = 0; i < month; i++) {
            newindex += dateLimit[i];
          }
          return newindex + date - 1;
        };
        $("#btn_add").click(function () {
          $("#memo").empty();
          $("#memo").append(
            "제목: <input id='title' /><br />일정:<input id='content' /><br /><button id='ok'>확인</button><button id='cancel'>취소</button>"
          );
          alert(year + " " + month + " " + date);
        });
      });
    </script>
  </head>
  <body>
    <div id="calender-layout">
      <div id="calender">
        <div id="calender-header"></div>
        <table id="calender-date"></table>
        <div id="new_date"></div>
        <a id="btn_add">일정 추가</a>
        <div id="memo"></div>
      </div>
    </div>
  </body>
</html>
