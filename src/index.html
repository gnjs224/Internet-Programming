<!DOCTYPE html>
<html lang="en">
  <head>
    <style>
      a:link {
        color: red;
        text-decoration: none;
        width: 10vh;
      }
      a:visited {
        color: black;
        text-decoration: none;
      }
      a:hover {
        background: #eee;
        text-decoration: none;
      }
      #header {
        width: auto;
        text-align: center;
        height: 10vh;
        line-height: 10vh;
      }
      #nav {
        text-align: center;
        margin: 0 auto;
      }
      #section {
        background: #eee;
      }
      #footer {
        width: auto;
        text-align: center;
        height: 10vh;
        line-height: 10vh;
      }
      #nav a {
        display: inline-block;
        width: 120px;
      }
      .btn_menu {
        cursor: pointer;
      }
      #section_title {
        text-align: center;
      }
      #imgset {
        display: inline-block;
      }
      #calender-layout {
        text-align: center;
      }
      #calender {
        display: inline-block;
        border: 1px solid black;
        width: 600px;
      }
      table,
      th,
      td {
        border: 1px solid white;
      }
      td,
      #btn_add {
        cursor: pointer;
      }
      table {
        width: 60%;
        margin: auto;
      }

      .normal {
        color: black;
      }
      .after {
        color: gray;
      }
      .before {
        color: gray;
      }
      .have {
        background-color: blue;
      }
      .selected {
        color: red;
        border: 1px solid red;
      }
      #title {
        width: 60%;
      }
      #content {
        width: 60%;
        height: 20vh;
      }
      .ban {
        pointer-events: none;
        cursor: default;
        color: gray;
      }
    </style>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>이력관리</title>
    <script src="http://code.jquery.com/jquery-3.1.1.js"></script>
    <script>
      $(function () {
        var DrawHome = function () {
          $("#section").html(
            "<img align = 'left' style='border: 3px solid #fdc324; border-radius: 7px' src='/me'/>",
            "<h1>이 웹사이트는 김지훈의 개인 프로젝트로 인해 제작되었습니다.</h1>"
          );
        };
        DrawHome();
        var lists = [
          "home",
          "imformation",
          "record",
          "project",
          "goal",
          "plan",
          "diary",
        ];
        $.each(lists, function (index, value) {
          if (index != 0) {
            $("#btn_group").append(
              $("<a class = 'btn_menu' value='" + value + "'>" + value + "</a>")
            );
          }
        });
        $(".btn_menu").click(function () {
          var menu = $(this).attr("value");
          $("#title").html("<h1>my " + menu + "</h1>");
          switch (menu) {
            case "home":
              DrawHome();
              break;
            case "imformation":
              $("#section").html(
                "<h1>기본 정보</h1>",
                "<h1>이름: 김지훈</h1>",
                "<h1>생년월일: 1998/02/24</h1>",
                "<h1>성별: 남자</h1>",
                "<h1>학력: 명지대학교 졸업</h1>",
                "<h1>전공: 컴퓨터 공학과</h1>",
                "<h1>연락처</h1>",
                "<h1>Email: ben224@naver.com</h1>",
                "<h1>전화번호: 010 7654 6434</h1>",
                "<h1>인스타그램: <a href = 'https://www.instagram.com/j_h_kimm/'>j_h_kimm</a></h1>",
                "<h1>전공 관련 계정</h1>",
                "<h1>Gitgub: <a href = 'https://github.com/gnjs224/'>gnjs224</a></h1>",
                "<h1>백준: <a href = 'https://www.acmicpc.net/user/ben224'>ben224</a></h1>",
                "<h1>벨로그: <a href = 'https://velog.io/@gnjs224'>gnjs224</a></h1>"
              );
              break;
            case "record":
              $("#section").html("<h1>hi</h1>");
              break;
            case "project":
              $("#section").html("<h1>hi</h1>");
              break;
            case "goal":
              $("#section").html("<h1>이 웹사이트 만들어서 배포하기</h1>");
              break;

            case "plan":
              $("#section").html("<h1>hi</h1>");
              break;

            case "diary":
              $("#section").html(
                "<div id='calender-layout'>" +
                  "<div id='calender'>" +
                  "<div id='calender-header'></div>" +
                  " <table id='calender-date'></table>" +
                  "<div id='new_date'></div>" +
                  "<a id='btn_add'>일정 추가</a>" +
                  "<div id='memo'></div>" +
                  "</div>" +
                  "</div>"
              );
              $(function () {
                const dateLimit = [
                  0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31,
                ];
                var count = 0;
                var today = new Date();
                const year = 2021;
                var month = today.getMonth() + 1;
                var date = today.getDate();

                $("#new_date").html(year + " " + month + " " + date);
                var ChangeIndex = function (m, d) {
                  var mon = m;
                  var da = d;
                  if (isNaN(m)) {
                    mon = month;
                    da = date;
                  }
                  var newindex = 0;
                  for (var i = 0; i < mon; i++) {
                    newindex += dateLimit[i];
                  }
                  return newindex + Number(da) - 1;
                };
                var DrawGetBox = function () {
                  $.ajax({
                    url: "http://127.0.0.1:52273/diary/" + ChangeIndex(),
                    type: "GET",
                  }).done((data) => {
                    $("#memo").empty();
                    if (data.error != null) {
                      $("#memo").append("<p>" + data.error + "</p>");
                    }

                    for (var i = 0; i < data.length; i++) {
                      $("#memo").append(
                        "<p>제목: " +
                          data[i].title +
                          "</p><p>내용: " +
                          data[i].content +
                          "</p><button class='modify' value=" +
                          i +
                          ">수정</button><button class='delete' value=" +
                          i +
                          ">삭제</button><br/>"
                      );
                    }
                    $(".modify").click(function () {
                      DrawAddBox(this.value);
                    });
                    $(".delete").click(function () {
                      if (confirm("정말 삭제하시겠습니까?") == true) {
                        $.ajax({
                          url:
                            "http://127.0.0.1:52273/diary/" +
                            ChangeIndex() +
                            "/" +
                            this.value,
                          type: "DELETE",
                        }).done((data) => {
                          alert(data.message);
                        });
                        DrawGetBox();
                      }
                    });
                  });
                };
                var DrawAddBox = function (index) {
                  $("#memo").empty();
                  var temptitle = " ";
                  var tempcontent = " ";
                  if (!isNaN(index)) {
                    $.ajax({
                      url:
                        "http://127.0.0.1:52273/diary/" +
                        ChangeIndex() +
                        "/" +
                        index,
                      async: false,
                    }).done((data) => {
                      temptitle = data.title;
                      tempcontent = data.content;
                    });
                  }
                  $("#memo").append(
                    "제목: <input id='title' value='" +
                      temptitle +
                      "' /><br/>" +
                      "일정:<input id='content' value='" +
                      tempcontent +
                      "' /><br/>" +
                      "<button id='ok'>확인</button>" +
                      "<button id='cancel'>취소</button>"
                  );
                  $("#cancel").click(function () {
                    DrawGetBox();
                  });
                  $("#ok").click(function () {
                    $.ajax({
                      url:
                        "http://127.0.0.1:52273/diary/" +
                        ChangeIndex() +
                        "/" +
                        index,
                      dataType: "json",
                      type: "PUT",
                      data: {
                        title: $("#title").val(),
                        content: $("#content").val(),
                      },
                    }).done((data) => {
                      alert(data.message);
                      DrawGetBox();
                    });
                  });
                };
                var DrawCalender = function () {
                  DrawGetBox();
                  $("#calender-header").html(
                    "<button class='before' value = '" +
                      date +
                      "'>a</button> " +
                      year +
                      "." +
                      month +
                      " <button class='after' value = '" +
                      date +
                      "'>b</button>"
                  );
                  $("#calender-date").html(
                    "<tr><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th><th>일</th></tr>"
                  );

                  var blank = 4;
                  for (var i = 1; i < month; i++) {
                    blank += dateLimit[i] % 7;
                  }
                  blank %= 7;
                  count = 0;
                  var over = false;
                  var part;
                  for (var i = 1 - blank; ; i++) {
                    var temp = i;
                    var tempmonth = month;
                    part = "normal";
                    if (temp <= 0) {
                      temp += dateLimit[month - 1];
                      if (temp <= 0) {
                        temp = "X";
                        part = "ban";
                      } else {
                        tempmonth--;
                        part = "before";
                      }
                    } else if (temp > dateLimit[month]) {
                      if (month == 12) {
                        temp = "X";
                        part = "ban";
                      } else {
                        temp -= dateLimit[month];
                        tempmonth++;
                        part = "after";
                      }
                    } else if (temp == dateLimit[month]) {
                      over = true;
                    }

                    var selected;
                    var have;
                    if (temp == date && part == "normal") {
                      selected = "selected";
                    } else {
                      selected = "";
                    }
                    $.ajax({
                      url:
                        "http://127.0.0.1:52273/diary/" +
                        ChangeIndex(tempmonth, temp),
                      type: "GET",
                      async: false,
                    }).done((data) => {
                      if (!data.error) {
                        have = "have";
                      } else {
                        have = "";
                      }
                    });
                    console.log(have);
                    if (count == 0) {
                      $("#calender-date").append("<tr>");
                    }
                    count++;
                    $("#calender-date").append(
                      "<td class =" +
                        selected +
                        " " +
                        part +
                        " " +
                        have +
                        " value = " +
                        temp +
                        ">" +
                        temp +
                        "</td>"
                    );
                    if (count == 7) {
                      $("#calender-date").append("</tr>");
                      if (over) break;
                      count = 0;
                    }
                  }
                  $("td, .before, .after").click(function () {
                    $("#memo").empty();
                    if ($(this).attr("class") == "before") {
                      month--;
                      if (month == 0) month += 12;
                    } else if ($(this).attr("class") == "after") {
                      month++;
                      if (month == 13) month -= 12;
                    }
                    date = $(this).attr("value");
                    $("#new_date").html(
                      year + " " + month + " " + $(this).attr("value")
                    );
                    DrawCalender();
                  });
                };
                DrawCalender();

                $("#btn_add").click(function () {
                  DrawAddBox();
                });
              });
              break;
          }
        });
      });
    </script>
    <!-- jquery를 이용한 css -->
    <script>
      $(function () {
        $("#nav a")
          .css("width", "120px")
          .css("height", "25px")
          .css("line-height", "25px")
          .css("border-radius", "15px");
        $("#calender").css("border", "1px solid black");
      });
    </script>
  </head>

  <body>
    <div id="header">
      <a><img class="btn_menu" value="home" src="/main" /></a>
    </div>
    <div id="nav">
      <div id="btn_group"></div>
    </div>
    <div id="section_title"><h1>my home</h1></div>
    <div id="section"></div>
    <div id="footer">bottom</div>
  </body>
</html>
